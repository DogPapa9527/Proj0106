<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥æœ¬æ—…éŠå°„é£›é¢ - éš¨æ©Ÿç›®çš„åœ°ç”¢ç”Ÿå™¨</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: "Microsoft JhengHei", "Hiragino Sans", sans-serif; }
        #map { height: 100vh; width: 100%; z-index: 1; }
        
        /* æ§åˆ¶é¢æ¿æ¨£å¼ */
        #controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            z-index: 1000;
            width: 300px;
            backdrop-filter: blur(5px);
        }
        h2 { margin-top: 0; font-size: 1.2rem; color: #333; border-bottom: 2px solid #ff5252; padding-bottom: 10px;}
        .control-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555;}
        input[type="range"] { width: 100%; }
        
        /* Checkbox æ¨£å¼å„ªåŒ– */
        .checkbox-group {
            display: flex;
            align-items: center;
            background: #f0f4f8;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .checkbox-group input { margin-right: 10px; transform: scale(1.2); }
        .checkbox-group label { margin-bottom: 0; cursor: pointer; }

        /* åœ“å½¢æ§åˆ¶å€å¡Šï¼Œç”¨æ–¼å‹¾é¸æ™‚ç¦ç”¨ */
        #circle-controls-wrapper {
            transition: opacity 0.3s, filter 0.3s;
        }
        .disabled-controls {
            opacity: 0.4;
            pointer-events: none; /* ç¦æ­¢é»æ“Š */
            filter: grayscale(100%);
        }

        button {
            background-color: #ff5252;
            color: white;
            border: none;
            padding: 12px 20px;
            width: 100%;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s, transform 0.1s;
        }
        button:hover { background-color: #e04040; }
        button:active { transform: scale(0.98); }
        
        #result-display {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #eee;
            font-size: 0.9rem;
            color: #555;
            line-height: 1.6;
        }
        a.gmap-link {
            color: #d93025;
            text-decoration: none;
            font-weight: bold;
            display: inline-block;
            margin-top: 5px;
        }
        .tip { font-size: 0.8rem; color: #888; margin-bottom: 5px; }
    </style>
</head>
<body>

    <div id="controls">
        <h2>ğŸ‡¯ğŸ‡µ æ—¥æœ¬æ—…éŠå°„é£›é¢</h2>
        
        <div class="checkbox-group control-group">
            <input type="checkbox" id="japan-wide-check">
            <label for="japan-wide-check">ğŸ—¾ æŒ‘æˆ°å…¨æ—¥æœ¬ç¯„åœï¼(éš¨æ©Ÿ)</label>
        </div>

        <div id="circle-controls-wrapper">
            <div class="control-group">
                <label>è‡ªè¨‚ç¯„åœåŠå¾‘: <span id="radius-val">100</span> km</label>
                <input type="range" id="radius-slider" min="10" max="1000" value="100" step="10">
            </div>
            <p class="tip">ğŸ’¡ æ‹–æ›³åœ°åœ–ä¸Šçš„è—è‰²æ¨™è¨˜ä¾†æ”¹è®Šå‡ºç™¼ä¸­å¿ƒé»</p>
        </div>
        
        <button onclick="throwDart()">ğŸ¯ å°„å‡ºé£›é¢ï¼</button>
        
        <div id="result-display">æº–å‚™å¥½é–‹å§‹ä½ çš„æ—¥æœ¬å†’éšªäº†å—ï¼Ÿ</div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // --- 1. åˆå§‹åŒ–è¨­å®š ---

        // é è¨­ä¸­å¿ƒé»ï¼šæ—¥æœ¬æ±äº¬é™„è¿‘
        const defaultLat = 35.6895;
        const defaultLng = 139.6917;
        // åˆå§‹åŒ–åœ°åœ–è¦–è§’èª¿æ•´ç‚ºå¯ä»¥çœ‹åˆ°å¤§éƒ¨åˆ†æ—¥æœ¬
        const map = L.map('map').setView([38.0, 137.0], 5);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors',
             // ä½¿ç”¨æ—¥æ–‡åœ°åœ–æ¨£å¼ (å¦‚æœæœ‰çš„è©±ï¼ŒOSM é è¨­æœƒæ ¹æ“šåœ°å€é¡¯ç¤º)
        }).addTo(map);

        // --- 2. è®Šæ•¸èˆ‡ UI å…ƒç´ å–å¾— ---
        let centerLat = defaultLat;
        let centerLng = defaultLng;
        let radiusKm = 100;
        let resultMarker = null;

        const japanWideCheck = document.getElementById('japan-wide-check');
        const circleControlsWrapper = document.getElementById('circle-controls-wrapper');
        const slider = document.getElementById('radius-slider');
        const radiusDisplay = document.getElementById('radius-val');

        // --- 3. å»ºç«‹åœ°åœ–å…ƒä»¶ (åœ“å½¢æ¨¡å¼ç”¨) ---
        
        // å»ºç«‹ä¸­å¿ƒé»æ¨™è¨˜
        const centerMarker = L.marker([centerLat, centerLng], {draggable: true}).addTo(map);
        centerMarker.bindPopup("å‡ºç™¼ä¸­å¿ƒé» (å¯æ‹–æ›³èª¿æ•´)").openPopup();

        // å»ºç«‹ç¯„åœåœ“åœˆ
        const rangeCircle = L.circle([centerLat, centerLng], {
            color: '#3388ff',
            fillColor: '#3388ff',
            fillOpacity: 0.15,
            weight: 2,
            radius: radiusKm * 1000
        }).addTo(map);

        // --- 4. äº‹ä»¶ç›£è½è™•ç† ---

        // ç›£è½ï¼šå…¨æ—¥æœ¬ Checkbox ç‹€æ…‹æ”¹è®Š
        japanWideCheck.onchange = function() {
            if (this.checked) {
                // æ¨¡å¼ï¼šå…¨æ—¥æœ¬ -> ç¦ç”¨åœ“å½¢æ§åˆ¶é …ã€éš±è—åœ“åœˆå’Œä¸­å¿ƒé»
                circleControlsWrapper.classList.add('disabled-controls');
                map.removeLayer(rangeCircle);
                map.removeLayer(centerMarker);
                map.flyTo([38.0, 137.0], 5); // è¦–é‡æ‹‰å›å…¨æ—¥æœ¬
