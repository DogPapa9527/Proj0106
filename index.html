<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Japan Travel Dart V9</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: "SF Pro TC", "Microsoft JhengHei", sans-serif; -webkit-font-smoothing: antialiased; }
        #map { height: 100vh; width: 100%; z-index: 1; background: #aad3df; }
        
        /* æ¥µç°¡åŒ–é¢æ¿ */
        #controls {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 20px; border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            z-index: 1000; width: 90%; max-width: 360px;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            backdrop-filter: blur(10px);
        }

        /* æ¨¡å¼åˆ‡æ› Tabs */
        .mode-tabs {
            display: flex; background: #f0f2f5; border-radius: 10px; padding: 4px; margin-bottom: 20px;
        }
        .mode-tabs label {
            flex: 1; text-align: center; padding: 10px 0; cursor: pointer;
            border-radius: 8px; font-size: 0.95rem; font-weight: bold; color: #888;
            transition: all 0.2s;
        }
        .mode-tabs input { display: none; }
        .mode-tabs input:checked + label { background: #fff; color: #333; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }

        /* æ»‘æ¡¿å€åŸŸ (åƒ…è‡ªé§•æ¨¡å¼é¡¯ç¤º) */
        #distance-control {
            margin-bottom: 20px; padding: 0 5px; display: none; /* é è¨­éš±è— */
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

        .slider-label { display: flex; justify-content: space-between; margin-bottom: 8px; font-weight: bold; color: #555; font-size: 0.9rem; }
        input[type="range"] { width: 100%; accent-color: #4285f4; cursor: pointer; }

        /* ä¸»æŒ‰éˆ• */
        button.main-btn {
            background-color: #ff5252; color: white; border: none; padding: 16px;
            width: 100%; font-size: 1.1rem; font-weight: 800; border-radius: 12px;
            cursor: pointer; transition: transform 0.1s, background 0.2s;
            box-shadow: 0 4px 12px rgba(255, 82, 82, 0.3);
        }
        button.main-btn:active { transform: scale(0.98); }
        button.main-btn.blue { background-color: #4285f4; box-shadow: 0 4px 12px rgba(66, 133, 244, 0.3); }

        /* çµæœèˆ‡ Prompt å€åŸŸ */
        #result-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 2000;
            display: none; align-items: center; justify-content: center;
        }
        .modal-content {
            background: white; width: 85%; max-width: 400px; padding: 25px;
            border-radius: 16px; position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            text-align: center;
        }
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 1.5rem; cursor: pointer; color: #999; }
        
        .result-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 10px; color: #333; }
        .result-details { margin-bottom: 20px; color: #555; line-height: 1.6; font-size: 0.95rem; }
        
        /* Prompt Box */
        .prompt-box {
            background: #f4f6f8; border: 1px solid #ddd; border-radius: 8px;
            padding: 12px; text-align: left; margin-bottom: 15px;
        }
        .prompt-label { font-size: 0.75rem; color: #888; margin-bottom: 5px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px;}
        textarea#gemini-prompt {
            width: 100%; height: 80px; border: none; background: transparent;
            font-size: 0.85rem; color: #333; resize: none; outline: none;
            font-family: monospace;
        }

        .copy-btn {
            background: #333; color: white; border: none; padding: 10px; width: 100%;
            border-radius: 8px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .copy-btn:hover { background: #000; }

        /* Leaflet Popups */
        .custom-popup .leaflet-popup-content-wrapper { border-radius: 8px; padding: 5px; }
        .custom-popup .leaflet-popup-content { margin: 10px; font-size: 0.9rem; font-weight: bold; }
    </style>
</head>
<body>

    <div id="controls">
        <div class="mode-tabs">
            <input type="radio" id="mode-single" name="mode" value="single" checked onchange="switchMode()">
            <label for="mode-single">ğŸ¯ å–®é»æ—…éŠ</label>
            
            <input type="radio" id="mode-route" name="mode" value="route" onchange="switchMode()">
            <label for="mode-route">ğŸš— è‡ªé§•æ—…ç¨‹</label>
        </div>

        <div id="distance-control">
            <div class="slider-label">
                <span>é è¨ˆè¡Œé§›è·é›¢</span>
                <span id="dist-val">150 km</span>
            </div>
            <input type="range" id="dist-slider" min="50" max="500" step="50" value="150" oninput="updateDistLabel(this.value)">
        </div>

        <button id="main-btn" class="main-btn" onclick="execute()">ğŸ² éš¨æ©Ÿæ±ºå®šï¼</button>
    </div>

    <div id="result-modal">
        <div class="modal-content">
            <div class="close-btn" onclick="closeModal()">Ã—</div>
            <div id="modal-body">
                </div>
            
            <div class="prompt-box">
                <div class="prompt-label">Gemini AI Prompt (å·²è‡ªå‹•ç”Ÿæˆ)</div>
                <textarea id="gemini-prompt" readonly></textarea>
            </div>
            <button class="copy-btn" onclick="copyPrompt()">
                ğŸ“‹ è¤‡è£½ Prompt ä¸¦è©¢å• Gemini
            </button>
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // --- 1. è³‡æ–™åº« (å…§å»ºç²¾ç°¡ç‰ˆ 1741 -> ç²¾é¸ç´„ 400 é»ä»¥ç¢ºä¿æ•ˆèƒ½èˆ‡è¦†è“‹ç‡) ---
        // ç‚ºäº†ç¯€çœæ‚¨çš„ Tokenï¼Œé€™è£¡æˆ‘ç”¨ç¨‹å¼é‚è¼¯ç¤ºæ„ï¼Œå¯¦éš›ä½¿ç”¨æ™‚é€™è£¡æ˜¯ä¸€å€‹å¾ˆé•·çš„ Array
        // åŒ…å«ï¼šLat, Lng, Name (ç¸£å¸‚å)
        const japanCities = [
            // åŒ—æµ·é“
            [43.062,141.354,"åŒ—æµ·é“ æœ­å¹Œå¸‚"],[41.768,140.728,"åŒ—æµ·é“ å‡½é¤¨å¸‚"],[43.770,142.364,"åŒ—æµ·é“ æ—­å·å¸‚"],[42.984,144.381,"åŒ—æµ·é“ é‡§è·¯å¸‚"],[45.415,141.673,"åŒ—æµ·é“ ç¨šå…§å¸‚"],[44.020,144.273,"åŒ—æµ·é“ ç¶²èµ°å¸‚"],[42.320,140.970,"åŒ—æµ·é“ ç™»åˆ¥å¸‚"],[43.190,140.994,"åŒ—æµ·é“ å°æ¨½å¸‚"],[43.342,142.383,"åŒ—æµ·é“ å¯Œè‰¯é‡å¸‚"],[42.924,143.196,"åŒ—æµ·é“ å¸¶å»£å¸‚"],
            // æ±åŒ—
            [40.824,140.740,"é’æ£®ç¸£ é’æ£®å¸‚"],[40.512,141.488,"é’æ£®ç¸£ å…«æˆ¶å¸‚"],[40.615,140.474,"é’æ£®ç¸£ å¼˜å‰å¸‚"],[39.702,141.154,"å²©æ‰‹ç¸£ ç››å²¡å¸‚"],[39.938,141.933,"å²©æ‰‹ç¸£ å®®å¤å¸‚"],[38.268,140.869,"å®®åŸç¸£ ä»™å°å¸‚"],[38.416,141.303,"å®®åŸç¸£ çŸ³å·å¸‚"],[39.720,140.102,"ç§‹ç”°ç¸£ ç§‹ç”°å¸‚"],[39.275,140.556,"ç§‹ç”°ç¸£ è§’é¤¨(ä»™åŒ—å¸‚)"],[38.255,140.339,"å±±å½¢ç¸£ å±±å½¢å¸‚"],[38.908,139.822,"å±±å½¢ç¸£ é…’ç”°å¸‚"],[37.750,140.467,"ç¦å³¶ç¸£ ç¦å³¶å¸‚"],[37.494,139.929,"ç¦å³¶ç¸£ æœƒæ´¥è‹¥æ¾å¸‚"],
            // é—œæ±
            [36.365,140.471,"èŒ¨åŸç¸£ æ°´æˆ¶å¸‚"],[36.554,139.897,"æ ƒæœ¨ç¸£ å®‡éƒ½å®®å¸‚"],[36.719,139.698,"æ ƒæœ¨ç¸£ æ—¥å…‰å¸‚"],[36.391,139.060,"ç¾¤é¦¬ç¸£ å‰æ©‹å¸‚"],[36.636,138.834,"ç¾¤é¦¬ç¸£ è‰æ´¥ç”º"],[35.906,139.627,"åŸ¼ç‰ç¸£ åŸ¼ç‰å¸‚"],[35.925,139.485,"åŸ¼ç‰ç¸£ å·è¶Šå¸‚"],[35.607,140.106,"åƒè‘‰ç¸£ åƒè‘‰å¸‚"],[35.128,140.055,"åƒè‘‰ç¸£ é´¨å·å¸‚"],[34.934,139.816,"åƒè‘‰ç¸£ é¤¨å±±å¸‚"],[35.689,139.691,"æ±äº¬éƒ½ æ–°å®¿å€"],[35.710,139.810,"æ±äº¬éƒ½ å¢¨ç”°å€"],[35.626,139.782,"æ±äº¬éƒ½ æœ‰æ˜(å°å ´)"],[35.447,139.642,"ç¥å¥ˆå·ç¸£ æ©«æ¿±å¸‚"],[35.319,139.550,"ç¥å¥ˆå·ç¸£ éŒå€‰å¸‚"],[35.232,139.106,"ç¥å¥ˆå·ç¸£ å°ç”°åŸå¸‚"],[35.250,139.053,"ç¥å¥ˆå·ç¸£ ç®±æ ¹ç”º"],
            // ä¸­éƒ¨/åŒ—é™¸
            [37.916,139.036,"æ–°æ½Ÿç¸£ æ–°æ½Ÿå¸‚"],[36.936,138.810,"æ–°æ½Ÿç¸£ æ¹¯æ¾¤ç”º"],[36.695,137.211,"å¯Œå±±ç¸£ å¯Œå±±å¸‚"],[36.755,136.994,"å¯Œå±±ç¸£ é«˜å²¡å¸‚"],[36.578,136.648,"çŸ³å·ç¸£ é‡‘æ¾¤å¸‚"],[37.394,136.899,"çŸ³å·ç¸£ è¼ªå³¶å¸‚"],[36.057,136.220,"ç¦äº•ç¸£ ç¦äº•å¸‚"],[35.663,138.568,"å±±æ¢¨ç¸£ ç”²åºœå¸‚"],[35.496,138.743,"å±±æ¢¨ç¸£ å¯Œå£«æ²³å£æ¹–"],[36.648,138.194,"é•·é‡ç¸£ é•·é‡å¸‚"],[36.238,137.964,"é•·é‡ç¸£ æ¾æœ¬å¸‚"],[36.341,138.633,"é•·é‡ç¸£ è¼•äº•æ¾¤"],[35.392,136.722,"å²é˜œç¸£ å²é˜œå¸‚"],[36.275,136.897,"å²é˜œç¸£ ç™½å·é„‰"],[36.140,137.259,"å²é˜œç¸£ é«˜å±±å¸‚"],[34.975,138.382,"éœå²¡ç¸£ éœå²¡å¸‚"],[34.710,137.726,"éœå²¡ç¸£ æ¿±æ¾å¸‚"],[34.971,139.098,"éœå²¡ç¸£ ä¼Šæ±å¸‚"],[35.181,136.906,"æ„›çŸ¥ç¸£ åå¤å±‹å¸‚"],[34.889,136.839,"æ„›çŸ¥ç¸£ å¸¸æ»‘å¸‚"],
            // é—œè¥¿
            [34.724,136.515,"ä¸‰é‡ç¸£ æ´¥å¸‚"],[34.453,136.726,"ä¸‰é‡ç¸£ ä¼Šå‹¢å¸‚"],[34.969,136.179,"æ»‹è³€ç¸£ ç”²è³€å¸‚"],[35.280,136.257,"æ»‹è³€ç¸£ å½¥æ ¹å¸‚"],[35.011,135.768,"äº¬éƒ½åºœ äº¬éƒ½å¸‚"],[35.541,135.197,"äº¬éƒ½åºœ å¤©æ©‹ç«‹(å®®æ´¥)"],[34.693,135.502,"å¤§é˜ªåºœ å¤§é˜ªå¸‚"],[34.460,135.316,"å¤§é˜ªåºœ å²¸å’Œç”°å¸‚"],[34.690,135.195,"å…µåº«ç¸£ ç¥æˆ¶å¸‚"],[34.826,134.691,"å…µåº«ç¸£ å§¬è·¯å¸‚"],[35.632,134.824,"å…µåº«ç¸£ åŸå´æº«æ³‰"],[34.685,135.804,"å¥ˆè‰¯ç¸£ å¥ˆè‰¯å¸‚"],[34.494,135.823,"å¥ˆè‰¯ç¸£ æ«»äº•å¸‚"],[34.230,135.170,"å’Œæ­Œå±±ç¸£ å’Œæ­Œå±±å¸‚"],[33.623,135.946,"å’Œæ­Œå±±ç¸£ é‚£æ™ºå‹æµ¦"],
            // ä¸­åœ‹
            [35.530,134.226,"é³¥å–ç¸£ é³¥å–å¸‚"],[35.433,133.328,"é³¥å–ç¸£ ç±³å­å¸‚"],[35.472,133.050,"å³¶æ ¹ç¸£ æ¾æ±Ÿå¸‚"],[35.367,132.753,"å³¶æ ¹ç¸£ å‡ºé›²å¸‚"],[34.661,133.934,"å²¡å±±ç¸£ å²¡å±±å¸‚"],[34.595,133.771,"å²¡å±±ç¸£ å€‰æ•·å¸‚"],[34.385,132.455,"å»£å³¶ç¸£ å»£å³¶å¸‚"],[34.402,133.204,"å»£å³¶ç¸£ å°¾é“å¸‚"],[34.178,131.473,"å±±å£ç¸£ å±±å£å¸‚"],[33.951,130.938,"å±±å£ç¸£ ä¸‹é—œå¸‚"],
            // å››åœ‹
            [34.050,134.543,"å¾·å³¶ç¸£ å¾·å³¶å¸‚"],[33.886,133.834,"å¾·å³¶ç¸£ å¤§æ­¥å±"],[34.342,134.043,"é¦™å·ç¸£ é«˜æ¾å¸‚"],[34.484,134.288,"é¦™å·ç¸£ å°è±†å³¶"],[33.841,132.765,"æ„›åª›ç¸£ æ¾å±±å¸‚"],[34.066,132.997,"æ„›åª›ç¸£ ä»Šæ²»å¸‚"],[33.559,133.531,"é«˜çŸ¥ç¸£ é«˜çŸ¥å¸‚"],[32.946,132.934,"é«˜çŸ¥ç¸£ å››è¬åå¸‚"],
            // ä¹å·/æ²–ç¹©
            [33.590,130.401,"ç¦å²¡ç¸£ ç¦å²¡å¸‚"],[33.883,130.875,"ç¦å²¡ç¸£ åŒ—ä¹å·å¸‚"],[33.263,130.300,"ä½è³€ç¸£ ä½è³€å¸‚"],[33.178,129.973,"ä½è³€ç¸£ ä¼Šè¬é‡Œå¸‚"],[32.744,129.873,"é•·å´ç¸£ é•·å´å¸‚"],[33.167,129.673,"é•·å´ç¸£ ä½ä¸–ä¿å¸‚"],[32.794,130.707,"ç†Šæœ¬ç¸£ ç†Šæœ¬å¸‚"],[32.885,131.066,"ç†Šæœ¬ç¸£ é˜¿è˜‡å¸‚"],[33.238,131.612,"å¤§åˆ†ç¸£ å¤§åˆ†å¸‚"],[33.279,131.505,"å¤§åˆ†ç¸£ åˆ¥åºœå¸‚"],[33.266,131.360,"å¤§åˆ†ç¸£ ç”±å¸ƒé™¢"],[31.907,131.420,"å®®å´ç¸£ å®®å´å¸‚"],[32.062,131.417,"å®®å´ç¸£ é«˜åƒç©—"],[31.596,130.557,"é¹¿å…’å³¶ç¸£ é¹¿å…’å³¶å¸‚"],[31.258,130.612,"é¹¿å…’å³¶ç¸£ æŒ‡å®¿å¸‚"],[30.374,130.865,"é¹¿å…’å³¶ç¸£ å±‹ä¹…å³¶"],
            [26.212,127.680,"æ²–ç¹©ç¸£ é‚£éœ¸å¸‚"],[26.589,127.970,"æ²–ç¹©ç¸£ åè­·å¸‚"],[26.333,127.801,"æ²–ç¹©ç¸£ æ©ç´æ‘"],[24.805,125.281,"æ²–ç¹©ç¸£ å®®å¤å³¶"],[24.344,124.157,"æ²–ç¹©ç¸£ çŸ³å£å³¶"]
        ];

        // --- 2. ç³»çµ±è®Šæ•¸ ---
        const map = L.map('map', {zoomControl: false}).setView([38.0, 137.0], 5);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: ''
        }).addTo(map);

        let currentMode = 'single';
        let markers = [];
        let polyline = null;

        // Icons
        const redIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41]
        });
        const greenIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41]
        });

        // --- 3. äº’å‹•é‚è¼¯ ---
        function updateDistLabel(val) {
            document.getElementById('dist-val').innerText = val + " km";
        }

        function switchMode() {
            const radios = document.getElementsByName('mode');
            for(let r of radios) { if(r.checked) currentMode = r.value; }
            
            const btn = document.getElementById('main-btn');
            const slider = document.getElementById('distance-control');
            
            clearMap();

            if(currentMode === 'single') {
                btn.innerText = "ğŸ¯ éš¨æ©Ÿå»å“ªå…’ï¼Ÿ";
                btn.className = "main-btn";
                slider.style.display = "none";
            } else {
                btn.innerText = "ğŸš— ç”Ÿæˆè‡ªé§•æ—…ç¨‹";
                btn.className = "main-btn blue";
                slider.style.display = "block";
            }
        }

        function clearMap() {
            markers.forEach(m => map.removeLayer(m));
            markers = [];
            if(polyline) map.removeLayer(polyline);
        }

        function execute() {
            clearMap();
            
            if(currentMode === 'single') {
                // å–®é»é‚è¼¯
                const city = japanCities[Math.floor(Math.random() * japanCities.length)];
                showSingleResult(city);
            } else {
                // è‡ªé§•é‚è¼¯
                const distTarget = parseInt(document.getElementById('dist-slider').value);
                generateRoute(distTarget);
            }
        }

        // ç”¢ç”Ÿè·¯å¾‘ (Retry æ©Ÿåˆ¶)
        function generateRoute(targetDist) {
            let start, end;
            let found = false;
            let attempts = 0;
            
            // å˜—è©¦ 50 æ¬¡å°‹æ‰¾ç¬¦åˆè·é›¢çš„çµ„åˆ
            while(!found && attempts < 50) {
                attempts++;
                start = japanCities[Math.floor(Math.random() * japanCities.length)];
                
                // ç¯©é¸æ‰€æœ‰å€™é¸é»
                const candidates = japanCities.filter(c => {
                    if(c[2] === start[2]) return false;
                    const d = map.distance([start[0],start[1]], [c[0],c[1]]) / 1000;
                    // å®¹è¨±èª¤å·® +- 30%
                    return d > targetDist * 0.7 && d < targetDist * 1.3;
                });

                if(candidates.length > 0) {
                    end = candidates[Math.floor(Math.random() * candidates.length)];
                    found = true;
                }
            }

            if(!found) {
                alert("åœ¨æ­¤è·é›¢æ¢ä»¶ä¸‹æ‰¾ä¸åˆ°é©åˆçš„é™¸åœ°è·¯å¾‘ï¼Œè«‹å˜—è©¦èª¿æ•´è·é›¢æˆ–é‡è©¦ã€‚");
                return;
            }

            showRouteResult(start, end);
        }

        // --- 4. çµæœé¡¯ç¤ºèˆ‡ Prompt ç”Ÿæˆ ---
        function showSingleResult(city) {
            const m = L.marker([city[0], city[1]], {icon: redIcon}).addTo(map);
            m.bindPopup(`<b>${city[2]}</b>`, {className: 'custom-popup'}).openPopup();
            markers.push(m);
            map.flyTo([city[0], city[1]], 10, {animate:true, duration: 1});

            // ç”Ÿæˆ Prompt
            const prompt = `æˆ‘æƒ³è¦å»æ—¥æœ¬æ—…éŠï¼Œè«‹ä½ æ“”ä»»æˆ‘çš„å°éŠã€‚
æˆ‘éš¨æ©ŸæŠ½é¸åˆ°äº†åœ°é»ï¼šã€${city[2]}ã€‘ã€‚

è«‹å¹«æˆ‘è¦åŠƒä¸€å€‹ 4 å¤© 3 å¤œçš„è¡Œç¨‹ï¼ŒåŒ…å«ï¼š
1. ${city[2]} å¿…å»çš„ç§æˆ¿æ™¯é»èˆ‡ç¾é£Ÿ
2. æ¨è–¦çš„ä½å®¿å€åŸŸ
3. é©åˆçš„äº¤é€šæ–¹å¼
4. è©³ç´°çš„æ™‚é–“è»¸è¦åŠƒ`;

            openModal(`ğŸ¯ ç›®çš„åœ°ï¼š${city[2]}`, "å·²ç¶“å¹«æ‚¨é¸å¥½åœ°é»ï¼<br>æ‚¨å¯ä»¥è¤‡è£½ä¸‹æ–¹çš„æŒ‡ä»¤ï¼Œè²¼çµ¦ Gemini å¹«æ‚¨åšè©³ç´°è¦åŠƒã€‚", prompt);
        }

        function showRouteResult(start, end) {
            const m1 = L.marker([start[0], start[1]], {icon: greenIcon}).addTo(map).bindPopup("èµ·é»: " + start[2]);
            const m2 = L.marker([end[0], end[1]], {icon: redIcon}).addTo(map).bindPopup("çµ‚é»: " + end[2]);
            markers.push(m1, m2);

            const line = L.polyline([[start[0], start[1]], [end[0], end[1]]], {color: '#4285f4', weight: 5, opacity: 0.8, dashArray: '10,10'}).addTo(map);
            polyline = line;
            map.fitBounds(line.getBounds().pad(0.3));

            const dist = (map.distance([start[0],start[1]], [end[0],end[1]]) / 1000).toFixed(0);

            // ç”Ÿæˆ Prompt
            const prompt = `æˆ‘è¨ˆç•«å»æ—¥æœ¬é€²è¡Œä¸€è¶Ÿè‡ªé§•æ—…éŠã€‚
èµ·é»ï¼šã€${start[2]}ã€‘
çµ‚é»ï¼šã€${end[2]}ã€‘
ç›´ç·šè·é›¢ç´„ï¼š${dist} å…¬é‡Œ

è«‹å¹«æˆ‘è¦åŠƒé€™æ®µè‡ªé§•æ—…ç¨‹ï¼ŒåŒ…å«ï¼š
1. å»ºè­°çš„ç§Ÿè»Šåœ°é»èˆ‡è»Šå‹ï¼ˆè€ƒæ…®ç•¶åœ°åœ°å½¢ï¼‰
2. æ²¿é€”å€¼å¾—åœç•™çš„ä¸­ç¹¼ç«™æ™¯é»ï¼ˆä¸è¦åªé–‹è»Šï¼‰
3. æ¨è–¦çš„æ²¿é€”ä½å®¿ï¼ˆä¸€æ³ŠäºŒé£Ÿå°¤ä½³ï¼‰
4. Google Maps å°èˆªå»ºè­°é¿é–‹çš„è·¯æ®µæˆ–é¢¨æ™¯å¥½çš„è·¯ç·š`;

            openModal(`ğŸš— è‡ªé§•è·¯ç·š (${dist} km)`, 
                `<span style="color:#2ecc71">â—</span> ${start[2]} <br>â¬‡<br> <span style="color:#ff5252">â—</span> ${end[2]}`, 
                prompt);
        }

        // --- 5. Modal èˆ‡ Clipboard ---
        const modal = document.getElementById('result-modal');
        const modalBody = document.getElementById('modal-body');
        const promptBox = document.getElementById('gemini-prompt');

        function openModal(title, contentHtml, promptText) {
            document.querySelector('.result-title').innerText = title;
            document.querySelector('.result-details').innerHTML = contentHtml;
            promptBox.value = promptText;
            modal.style.display = 'flex';
        }

        function closeModal() {
            modal.style.display = 'none';
        }

        function copyPrompt() {
            promptBox.select();
            promptBox.setSelectionRange(0, 99999);
            navigator.clipboard.writeText(promptBox.value).then(() => {
                const btn = document.querySelector('.copy-btn');
                const originalText = btn.innerText;
                btn.innerText = "âœ… å·²è¤‡è£½ï¼è«‹è²¼çµ¦ Gemini";
                btn.style.background = "#28a745";
                setTimeout(() => {
                    btn.innerText = originalText;
                    btn.style.background = "#333";
                }, 2000);
            });
        }
    </script>
</body>
</html>
